# Аннотация
Данная директория является вспомогательной и не имеет прямого отношения к сервису.
Тем не менее автор считает данную информацию полезной для сохранения.

## Панели
```
"panels": [
  {
    "type": "stat",          // Тип панели
    "title": "Example",      // Заголовок
    "gridPos": {             // Позиция и размер
      "h": 5, "w": 8, "x": 0, "y": 1
    },
    "targets": [             // Запросы к данным
      {
        "expr": "up{job=\"$job\"}",
        "refId": "A"
      }
    ]
  }
]
```
Типы панелей, которые стоит знать:
* singlestat - одиночное значение (устаревшее)
* stat - современная версия singlestat
* graph - графики временных рядов
* table - табличные данные
* row - контейнер для группировки панелей

Другие полезные поля панели:
* description - описание панели
* fieldConfig - конфигурация отображения данных, подробнее смотри ниже

## Система расположения панелей
```
"gridPos": {
"h": 5,    // высота в "юнитах"
"w": 8,    // ширина в колонках (макс 24)
"x": 0,    // позиция X (отступ слева)
"y": 1     // позиция Y (отступ сверху)
}
```

## Запросы
```
"targets": [
  {
    "expr": "up{job=\"$job\"}",
    "format": "time_series",
    "refId": "A"
  }
]
```
* expr - PromQL запрос
* format - формат данных (time_series, table)
* refId - ссылка для использования в других вычислениях

## Переменные
```
"templating": {
  "list": [
    {
      "name": "job",
      "query": "label_values(go_memstats_alloc_bytes,job)",
      "type": "query"
    }
  ]
}
```
Переменные позволяют фильтровать данные:
* $job - выбранная job
* $interval - временной интервал
* $grpc_service - выбранный gRPC сервис

## Временные диапазоны
```
"time": {
  "from": "now-6h",
  "to": "now"
},
"refresh": "10s"
```

# Описание примеров

Все метрики можно узнать в: http://localhost:9000/metrics

* example-1 - Простейший dashboard.
* grafana-example-1 - Вид, в который он автоматически преобразуется grafana для работы.


## Подробная информация:

### На основе example-2:

### Панели:

#### fieldConfig:
unit: Форматирование числовых значений
* "short" - автоматическое форматирование (1K, 1M, 1B)
* "reqps" - запросы в секунду
* "ms" - миллисекунды
* "bytes" - байты
* "percent" - проценты
* "none" - без форматирования

color:
* "palette-classic" - классическая палитра Grafana
* "thresholds" - цвет на основе пороговых значений
* "fixed" - фиксированный цвет
* "continuous-GrYlRd" - градиент от зеленого к красному

thresholds: Пороговые значения
* steps - массив порогов
* Каждый шаг: {"color": "цвет", "value": число}
* value: null - означает "все значения выше предыдущего порога"
```
"defaults": {
  "decimals": 2,          // знаков после запятой
  "min": 0,               // минимальное значение шкалы
  "max": 100,             // максимальное значение шкалы
  "displayName": "Name",  // кастомное имя поля
  "links": [              // кликабельные ссылки
    {
      "title": "View Details",
      "url": "https://example.com"
    }
  ],
  "custom": {             // специфичные для типа панели настройки
    "displayMode": "lcd", // для stat панели
    "orientation": "horizontal"
  }
},
"overrides": [            // переопределения для конкретных полей
  {
    "matcher": {
      "id": "byName",
      "options": "error_rate"
    },
    "properties": [
      {"id": "color", "value": {"mode": "fixed", "fixedColor": "red"}}
    ]
  }
]
```

#### targets:
expr : rate(link\[5m]) - среднее значение в окне 5 минут, link - обычные данные.

expr : histogram_quantile(0.95, rate(link\[5m])) - 95 квантиль за 5 мин.

legendFormat: "QPS" - название колонок на графике.

### Переменные (templating):

Основная идея - использовать одни и те же панели для разных сервисов.

#### name: "job"
- Имя переменной, используется с \$ в запросах: \$job

#### type: "query"
Типы переменных:

* query - значения из запроса к БД (Prometheus)
* interval - предопределенные интервалы времени
* custom - ручной ввод значений
* datasource - выбор источника данных

#### query: "label_values(up, job)"
label_values(metric, label) - специальная функция Grafana:

* Получает все уникальные значения label job из метрики up
* Возвращает: \["library", "api-service", "database", ...]

#### refresh: 1
Когда обновлять список значений:

* 1 - при загрузке дашборда

* 2 - при изменении временного диапазона
